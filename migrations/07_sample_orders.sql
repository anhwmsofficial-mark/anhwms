-- ====================================================================
-- ANH WMS v2 - 샘플 데이터 (입출고 & 반품)
-- ====================================================================
-- 실제 주문/입고/출고/반품 시나리오 데이터
-- ====================================================================

-- ====================================================================
-- 1. 입고 오더 (Inbound Shipment)
-- ====================================================================

INSERT INTO inbound_shipment (id, warehouse_id, owner_brand_id, ref_no, type, status, eta) VALUES
-- 영블랙 정기 입고
('B0000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', 'IB-YBK-20250115-001', 'PURCHASE', 'COMPLETED', '2025-01-15 10:00:00+09'),
('B0000000-0000-0000-0000-000000000002', '40000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', 'IB-YBK-20250120-001', 'PURCHASE', 'RECEIVING', '2025-01-20 14:00:00+09'),

-- 글로우업 신제품 입고
('B0000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000003', 'IB-GLW-20250118-001', 'PURCHASE', 'COMPLETED', '2025-01-18 09:00:00+09'),

-- 스타일랩 입고
('B0000000-0000-0000-0000-000000000004', '40000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000004', 'IB-STL-20250119-001', 'PURCHASE', 'DRAFT', '2025-01-25 11:00:00+09')
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 2. 입고 라인 (Inbound Shipment Line)
-- ====================================================================

INSERT INTO inbound_shipment_line (id, inbound_shipment_id, product_id, uom_code, qty_expected, qty_received, line_no) VALUES
-- IB-YBK-20250115-001 (완료)
('C0000000-0000-0000-0000-000000000001', 'B0000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000001', 'EA', 500, 500, 1),
('C0000000-0000-0000-0000-000000000002', 'B0000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000002', 'EA', 300, 300, 2),
('C0000000-0000-0000-0000-000000000003', 'B0000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000003', 'EA', 800, 800, 3),

-- IB-YBK-20250120-001 (입고 중)
('C0000000-0000-0000-0000-000000000004', 'B0000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000004', 'EA', 600, 350, 1),
('C0000000-0000-0000-0000-000000000005', 'B0000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000005', 'EA', 400, 200, 2),

-- IB-GLW-20250118-001 (완료)
('C0000000-0000-0000-0000-000000000006', 'B0000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000009', 'EA', 700, 700, 1),
('C0000000-0000-0000-0000-000000000007', 'B0000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000010', 'EA', 350, 350, 2),
('C0000000-0000-0000-0000-000000000008', 'B0000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000011', 'EA', 200, 200, 3),

-- IB-STL-20250119-001 (예정)
('C0000000-0000-0000-0000-000000000009', 'B0000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000012', 'EA', 150, 0, 1),
('C0000000-0000-0000-0000-000000000010', 'B0000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000013', 'EA', 80, 0, 2)
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 3. 출고 라인 (Outbound Order Line) - 기존 outbounds 테이블 연결
-- ====================================================================

-- 먼저 outbounds 테이블에 v2 필드 추가 (이미 존재하는 경우 무시)
DO $$
BEGIN
  -- warehouse_id 추가
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='outbounds' AND column_name='warehouse_id') THEN
    ALTER TABLE outbounds ADD COLUMN warehouse_id UUID REFERENCES warehouse(id);
  END IF;
  
  -- brand_id 추가
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='outbounds' AND column_name='brand_id') THEN
    ALTER TABLE outbounds ADD COLUMN brand_id UUID REFERENCES brand(id);
  END IF;
  
  -- store_id 추가
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='outbounds' AND column_name='store_id') THEN
    ALTER TABLE outbounds ADD COLUMN store_id UUID REFERENCES store(id);
  END IF;
  
  -- order_type 추가
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='outbounds' AND column_name='order_type') THEN
    ALTER TABLE outbounds ADD COLUMN order_type TEXT DEFAULT 'B2C';
  END IF;
  
  -- channel_order_no 추가
  IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='outbounds' AND column_name='channel_order_no') THEN
    ALTER TABLE outbounds ADD COLUMN channel_order_no TEXT;
  END IF;
END $$;

-- outbound_order_line 샘플 데이터 (기존 outbounds와 연결)
-- 실제 outbounds 데이터가 있다면 해당 ID와 연결하여 생성

-- ====================================================================
-- 4. 배송 계정 (Shipping Account)
-- ====================================================================

INSERT INTO shipping_account (id, customer_master_id, carrier_id, account_code, account_name, is_anh_owned, status) VALUES
-- ANH 자체 배송 계정
('D0000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 
  (SELECT id FROM shipping_carrier WHERE code = 'CJ' LIMIT 1), 
  'ANH-CJ-MAIN', 'ANH CJ대한통운 메인계정', TRUE, 'ACTIVE'),
('D0000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 
  (SELECT id FROM shipping_carrier WHERE code = 'LOTTE' LIMIT 1), 
  'ANH-LOTTE-01', 'ANH 롯데택배 계정', TRUE, 'ACTIVE'),

-- 영블랙 전용 계정
('D0000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 
  (SELECT id FROM shipping_carrier WHERE code = 'HANJIN' LIMIT 1), 
  'YBK-HANJIN-01', '영블랙 한진택배 계정', FALSE, 'ACTIVE')
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 5. 택배 물량 (Parcel Shipment)
-- ====================================================================

INSERT INTO parcel_shipment (id, shipping_account_id, brand_id, warehouse_id, source_type, tracking_no, ship_date, dest_country_code, weight_kg, fee_total, fee_currency, billing_status) VALUES
-- 최근 배송 데이터
('E0000000-0000-0000-0000-000000000001', 'D0000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', 'WMS', '123456789012', '2025-01-15', 'KR', 0.5, 2800, 'KRW', 'UNBILLED'),
('E0000000-0000-0000-0000-000000000002', 'D0000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', 'WMS', '123456789013', '2025-01-16', 'KR', 0.3, 2800, 'KRW', 'UNBILLED'),
('E0000000-0000-0000-0000-000000000003', 'D0000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', 'WMS', '123456789014', '2025-01-17', 'KR', 0.8, 3000, 'KRW', 'BILLED'),
('E0000000-0000-0000-0000-000000000004', 'D0000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000001', 'WMS', '987654321001', '2025-01-18', 'KR', 0.4, 2800, 'KRW', 'UNBILLED'),
('E0000000-0000-0000-0000-000000000005', 'D0000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', 'WMS', '555666777888', '2025-01-19', 'KR', 0.6, 2900, 'KRW', 'UNBILLED')
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 6. 반품 오더 (Return Order)
-- ====================================================================

INSERT INTO return_order (id, warehouse_id, brand_id, store_id, source_type, carrier_code, tracking_no, status, reason_code, disposition) VALUES
-- 네이버 스마트스토어 반품
('F0000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 'OUR_OUTBOUND', 'CJ', '999888777666', 'RECEIVED', 'SIZE_MISMATCH', 'RESTOCK'),
('F0000000-0000-0000-0000-000000000002', '40000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000002', 'OUR_OUTBOUND', 'LOTTE', '777666555444', 'INSPECTED', 'DEFECTIVE', 'SCRAP'),
('F0000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000004', 'OUR_OUTBOUND', 'CJ', '555444333222', 'CREATED', 'CHANGE_MIND', 'RESTOCK'),

-- 외부 반품 (채널 직접 처리)
('F0000000-0000-0000-0000-000000000004', '40000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 'EXTERNAL', 'HANJIN', '111222333444', 'COMPLETED', 'DAMAGED', 'SCRAP')
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 7. 반품 라인 (Return Order Line)
-- ====================================================================

INSERT INTO return_order_line (id, return_order_id, product_id, uom_code, qty_returned, qty_accepted, qty_restocked, qty_scrapped, line_no) VALUES
-- 반품 1 (재입고 가능)
('G0000000-0000-0000-0000-000000000001', 'F0000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000001', 'EA', 1, 1, 1, 0, 1),
('G0000000-0000-0000-0000-000000000002', 'F0000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000002', 'EA', 1, 1, 1, 0, 2),

-- 반품 2 (불량품 폐기)
('G0000000-0000-0000-0000-000000000003', 'F0000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000005', 'EA', 1, 0, 0, 1, 1),

-- 반품 3 (단순 변심, 재입고)
('G0000000-0000-0000-0000-000000000004', 'F0000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000009', 'EA', 2, 2, 0, 0, 1),

-- 반품 4 (파손, 폐기 완료)
('G0000000-0000-0000-0000-000000000005', 'F0000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000006', 'EA', 1, 0, 0, 1, 1)
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 8. 청구서 (Billing Invoice) - 월별 배송비 청구
-- ====================================================================

INSERT INTO billing_invoice (id, customer_master_id, invoice_no, invoice_type, billing_month, total_amount, currency, status) VALUES
-- 영블랙 1월 배송비 청구
('H0000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'INV-2025-01-YBK', 'SHIPPING', '2025-01', 125000, 'KRW', 'ISSUED'),

-- 글로우업 1월 배송비 청구
('H0000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000002', 'INV-2025-01-GLW', 'SHIPPING', '2025-01', 85000, 'KRW', 'DRAFT')
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 9. 청구서 라인 (Billing Invoice Line)
-- ====================================================================

INSERT INTO billing_invoice_line (id, billing_invoice_id, item_type, item_ref_id, item_description, quantity, unit_price, amount, line_no) VALUES
-- 영블랙 배송비 상세
('I0000000-0000-0000-0000-000000000001', 'H0000000-0000-0000-0000-000000000001', 'SHIPPING_FEE', 'E0000000-0000-0000-0000-000000000001', 'CJ대한통운 배송 (0.5kg)', 1, 2800, 2800, 1),
('I0000000-0000-0000-0000-000000000002', 'H0000000-0000-0000-0000-000000000001', 'SHIPPING_FEE', 'E0000000-0000-0000-0000-000000000002', 'CJ대한통운 배송 (0.3kg)', 1, 2800, 2800, 2),
('I0000000-0000-0000-0000-000000000003', 'H0000000-0000-0000-0000-000000000001', 'SHIPPING_FEE', 'E0000000-0000-0000-0000-000000000003', 'CJ대한통운 배송 (0.8kg)', 1, 3000, 3000, 3),
('I0000000-0000-0000-0000-000000000004', 'H0000000-0000-0000-0000-000000000001', 'FULFILLMENT_FEE', NULL, '풀필먼트 서비스 (45건)', 45, 2500, 112500, 4),
('I0000000-0000-0000-0000-000000000005', 'H0000000-0000-0000-0000-000000000001', 'STORAGE_FEE', NULL, '보관료 (100㎥)', 100, 39, 3900, 5),

-- 글로우업 배송비 상세
('I0000000-0000-0000-0000-000000000006', 'H0000000-0000-0000-0000-000000000002', 'SHIPPING_FEE', 'E0000000-0000-0000-0000-000000000004', '롯데택배 배송 (0.4kg)', 1, 2800, 2800, 1),
('I0000000-0000-0000-0000-000000000007', 'H0000000-0000-0000-0000-000000000002', 'FULFILLMENT_FEE', NULL, '풀필먼트 서비스 (30건)', 30, 2500, 75000, 2),
('I0000000-0000-0000-0000-000000000008', 'H0000000-0000-0000-0000-000000000002', 'STORAGE_FEE', NULL, '보관료 (30㎥)', 30, 39, 1170, 3),
('I0000000-0000-0000-0000-000000000009', 'H0000000-0000-0000-0000-000000000002', 'VALUE_ADDED_FEE', NULL, '부가서비스 (재포장 10건)', 10, 500, 5000, 4)
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 10. 시스템 알림 (System Alert)
-- ====================================================================

INSERT INTO system_alert (id, alert_type, severity, brand_id, warehouse_id, title, message, status) VALUES
-- 재고 부족 경고
('J0000000-0000-0000-0000-000000000001', 'INVENTORY_LOW', 'WARNING', '20000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', '재고 부족 경고 - 영블랙 립스틱', '영블랙 립스틱 (핑크) 재고가 최소 수량 이하입니다. 현재고: 180개', 'OPEN'),

-- 주문 지연 알림
('J0000000-0000-0000-0000-000000000002', 'ORDER_DELAYED', 'ERROR', '20000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000001', '주문 처리 지연', '3건의 주문이 SLA를 초과했습니다. 긴급 처리 필요', 'OPEN'),

-- 반품 입고 알림
('J0000000-0000-0000-0000-000000000003', 'RETURN_RECEIVED', 'INFO', '20000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000003', '반품 입고 완료', '반품 4건이 반품센터에 입고되었습니다. 검수 대기 중', 'ACKNOWLEDGED'),

-- 정산 마감 알림
('J0000000-0000-0000-0000-000000000004', 'BILLING_DUE', 'WARNING', '20000000-0000-0000-0000-000000000001', NULL, '정산 마감 임박', '영블랙 1월 정산이 3일 후 마감됩니다.', 'OPEN')
ON CONFLICT (id) DO NOTHING;

-- ====================================================================
-- 완료
-- ====================================================================
-- 입출고 & 반품 샘플 데이터 생성 완료!
-- 
-- 생성된 데이터:
-- - 입고 오더: 4건
-- - 입고 라인: 10건
-- - 배송 계정: 3개
-- - 택배 물량: 5건
-- - 반품 오더: 4건
-- - 반품 라인: 5건
-- - 청구서: 2건
-- - 청구서 라인: 9건
-- - 시스템 알림: 4건
-- ====================================================================

